(()=>{"use strict";var e={456:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GithubService=void 0,t.GithubService=class{constructor(){this._baseGitHubUrl="https://api.github.com/repos/asiainspection/qima-platform",this._requestHeaders={},this._loadGitHubToken()}_loadGitHubToken(){chrome.storage.sync.get("github_token",(e=>{this._requestHeaders={Authorization:`Bearer ${e.github_token}`}}))}getLabels(){return fetch(`${this._baseGitHubUrl}/labels`,{headers:this._requestHeaders}).then((e=>e.json()))}getPullRequests(){return fetch(`${this._baseGitHubUrl}/pulls`,{headers:this._requestHeaders}).then((e=>e.json()))}addLabelToPullRequest(e,t){return fetch(`${this._baseGitHubUrl}/issues/${t}/labels`,{method:"POST",headers:this._requestHeaders,body:JSON.stringify({labels:[e]})})}}},911:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(a,n){function l(e){try{o(s.next(e))}catch(e){n(e)}}function r(e){try{o(s.throw(e))}catch(e){n(e)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,r)}o((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=i(456);new class{constructor(){this._availableColor='style="--label-r:166;--label-g:252;--label-b:189;--label-h:136;--label-s:93;--label-l:81; cursor: pointer"',this._unavailableColor='style="--label-r:188;--label-g:33;--label-b:5;--label-h:9;--label-s:94;--label-l:37;"',this._qimaSandboxesRefreshButtonId="qima-sandboxes-refresh-button",this._qimaSandboxesWrapperId="qima-sandboxes",this._qimaMainWrapperId="qima-github",this._qimaSandboxAvailableClassName="qima-deploy-available",this._refreshStatusButton=`\n    <button class="float-right d-block text-center mr-2 btn-link muted-icon" id="${this._qimaSandboxesRefreshButtonId}">\n        <span class="reviewers-status-icon tooltipped tooltipped-nw" aria-label="Refresh sandboxes status">\n            <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-sync">\n                <path fill-rule="evenodd" d="M8 2.5a5.487 5.487 0 00-4.131 1.869l1.204 1.204A.25.25 0 014.896 6H1.25A.25.25 0 011 5.75V2.104a.25.25 0 01.427-.177l1.38 1.38A7.001 7.001 0 0114.95 7.16a.75.75 0 11-1.49.178A5.501 5.501 0 008 2.5zM1.705 8.005a.75.75 0 01.834.656 5.501 5.501 0 009.592 2.97l-1.204-1.204a.25.25 0 01.177-.427h3.646a.25.25 0 01.25.25v3.646a.25.25 0 01-.427.177l-1.38-1.38A7.001 7.001 0 011.05 8.84a.75.75 0 01.656-.834z"></path>\n            </svg>\n        </span>\n    </button>`,this._sandboxesWrapper=`<div class="discussion-sidebar-heading text-bold">Sandboxes availability ${this._refreshStatusButton}</div><div class="d-flex flex-wrap" id="${this._qimaSandboxesWrapperId}"></div>`,this._lastUrl="",this._gitHubService=new a.GithubService,this._initMutationObserver(),this._loadHelper()}_injectSandboxesWrapper(){var e;if(!document.getElementById(this._qimaMainWrapperId)){const t=document.getElementsByClassName("discussion-sidebar-item")[2],i=document.createElement("div");i.id=this._qimaMainWrapperId,i.className="discussion-sidebar-item",i.innerHTML=this._sandboxesWrapper,null===(e=t.parentNode)||void 0===e||e.insertBefore(i,t.nextSibling)}}_injectSandboxesStatus(){return s(this,void 0,void 0,(function*(){const e=yield this._gitHubService.getLabels();console.log(e);const t=e.filter((e=>-1!==e.name.indexOf("deploy-to-"))),i=(yield this._gitHubService.getPullRequests()).filter((e=>e.labels.some((e=>-1!==e.name.indexOf("deploy-to-"))))),s=t.map((e=>{let t=i.find((t=>t.labels.some((t=>-1!==t.name.indexOf(e.name)))));return`<a id="${e.name}" class="IssueLabel hx_IssueLabel width-fit mb-1 mr-1 ${t?"":this._qimaSandboxAvailableClassName}" ${t?this._unavailableColor:this._availableColor}>${e.name.split("deploy-to-")[1]}</a>`})).join("");document.getElementById(this._qimaSandboxesWrapperId).innerHTML=s,this._initListeners()}))}_loadHelper(){return s(this,void 0,void 0,(function*(){try{this._injectSandboxesWrapper(),yield this._injectSandboxesStatus()}catch(e){console.log(e)}}))}_initListeners(){var e;null===(e=document.getElementById(this._qimaSandboxesRefreshButtonId))||void 0===e||e.addEventListener("click",(()=>this._injectSandboxesStatus())),Array.from(document.getElementsByClassName(this._qimaSandboxAvailableClassName)).forEach((e=>{e.addEventListener("click",(()=>{var t;return this._gitHubService.addLabelToPullRequest(e.id,null!==(t=document.URL.split("/").pop())&&void 0!==t?t:"")}))}))}_initMutationObserver(){new MutationObserver((()=>{-1!==location.href.indexOf("https://github.com/asiainspection/qima-platform/pull/")?this._lastUrl!==location.href&&(this._lastUrl=location.href,setTimeout((()=>this._loadHelper()),2e3)):this._lastUrl=""})).observe(document,{subtree:!0,childList:!0})}}}},t={};!function i(s){var a=t[s];if(void 0!==a)return a.exports;var n=t[s]={exports:{}};return e[s].call(n.exports,n,n.exports,i),n.exports}(911)})();